<!DOCTYPE html>
<html lang="en">
<head>
  <!-- ... -->
</head>
<body>
  <!-- Input for image selection -->
  <input type="file" id="imageInput" accept="image/*">

  <!-- Button to trigger prediction -->
  <button id="predictButton">Predict Emotion</button>

  <!-- Display area for the result text -->
  <div id="resultText"></div>

  <!-- Your JavaScript code -->
  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      const imageInput = document.getElementById("imageInput");
      const predictButton = document.getElementById("predictButton");
      const resultText = document.getElementById("resultText");

      let session; // Variable to store the ONNX InferenceSession

      async function loadModel() {
        session = await ort.InferenceSession.create();
        await session.loadModel("https://github.com/Vallid9/FaceEmotionDetection/raw/bf085b879d7e39b0f6100d61b56777f59ab82e3f/Faceemotion_recognition_model.onnx");
      }

      predictButton.addEventListener("click", async () => {
        await loadModel(); // Load model once

        const imageFile = imageInput.files[0];
        const reader = new FileReader();

        reader.onload = async (event) => {
          const imageData = event.target.result;
          const prediction = await predictEmotion(imageData);
          resultText.innerHTML = `<hr>Predicted emotion: <br/> ${prediction}`;
        };

        reader.readAsDataURL(imageFile);
      });

      async function predictEmotion(imageData) {
        // Preprocess image according to your model requirements
        const imageTensor = preprocessImage(imageData);

        // Run inference using the loaded model
        const feeds = { input: imageTensor }; // Adjust the input key based on your model
        const result = await session.run(feeds);
        const outputData = result.variable.data;

        // Get and process output
        const predictions = outputData;
        const predictedClass = getPredictedClass(predictions);

        // Return the corresponding emotion name
        return getEmotionName(predictedClass);
      }

      // Function to preprocess image (you need to implement this)
      function preprocessImage(imageData) {
        // Implement image preprocessing here
        // Return the preprocessed image tensor
      }

      // Function to get predicted class (you need to implement this)
      function getPredictedClass(predictions) {
        // Implement logic to get the predicted class from predictions
        // Return the predicted class
      }

      // Function to get emotion name (you need to implement this)
      function getEmotionName(predictedClass) {
        // Implement logic to map predicted class to emotion name
        // Return the emotion name
      }
    });
  </script>
  <script src="https://cdn.jsdelivr.net/npm/onnxjs/dist/onnx.min.js"></script>
</body>
</html>
